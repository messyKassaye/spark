{"ast":null,"code":"import { useEffect, useState } from 'react';\nimport axios from 'axios';\nimport { get, removeToken, set } from \"../TokenService\";\nimport { API_AUTH_URL } from \"../constants/constants\";\n\nfunction Interceptor() {\n  axios.defaults.headers.common['Autherization'] = `Bearer ${get()}`;\n  axios.defaults.headers.common['Device'] = \"device\";\n  return axios.interceptors.response.use(response => {\n    return response;\n  }, err => {\n    return new Promise((resolve, reject) => {\n      const originalReq = err.config;\n\n      if (err.response.status === 401) {\n        originalReq._retry = true;\n        let res = fetch(`${API_AUTH_URL}refresh`, {\n          method: 'POST',\n          mode: 'cors',\n          cache: 'no-cache',\n          credentials: 'same-origin',\n          headers: {\n            'Content-Type': 'application/json',\n            'Device': 'device',\n            'Token': localStorage.getItem(\"token\")\n          },\n          redirect: 'follow',\n          referrer: 'no-referrer',\n          body: JSON.stringify({\n            token: get()\n          })\n        }).then(res => res.json()).then(res => {\n          console.log(res);\n          this.setSession({\n            token: res.token,\n            refresh_token: res.refresh\n          });\n          originalReq.headers['Autherization'] = `Bearer ${res.token}`;\n          originalReq.headers['Device'] = \"device\";\n          return axios(originalReq);\n        });\n        resolve(res);\n      }\n\n      return Promise.reject(err);\n    });\n  });\n}\n\nexport default Interceptor;","map":{"version":3,"sources":["D:/projects/spark/spark_front/src/interceptors/Interceptor.js"],"names":["useEffect","useState","axios","get","removeToken","set","API_AUTH_URL","Interceptor","defaults","headers","common","interceptors","response","use","err","Promise","resolve","reject","originalReq","config","status","_retry","res","fetch","method","mode","cache","credentials","localStorage","getItem","redirect","referrer","body","JSON","stringify","token","then","json","console","log","setSession","refresh_token","refresh"],"mappings":"AAAA,SAAQA,SAAR,EAAmBC,QAAnB,QAAkC,OAAlC;AACA,OAAOC,KAAP,MAAkB,OAAlB;AACA,SAAQC,GAAR,EAAaC,WAAb,EAA0BC,GAA1B,QAAoC,iBAApC;AACA,SAAQC,YAAR,QAA2B,wBAA3B;;AAGA,SAASC,WAAT,GAAuB;AACnBL,EAAAA,KAAK,CAACM,QAAN,CAAeC,OAAf,CAAuBC,MAAvB,CAA8B,eAA9B,IAAkD,UAASP,GAAG,EAAG,EAAjE;AACAD,EAAAA,KAAK,CAACM,QAAN,CAAeC,OAAf,CAAuBC,MAAvB,CAA8B,QAA9B,IAA0C,QAA1C;AACA,SAAOR,KAAK,CAACS,YAAN,CAAmBC,QAAnB,CAA4BC,GAA5B,CAAgCD,QAAQ,IAAI;AAC/C,WAAOA,QAAP;AACH,GAFM,EAEJE,GAAG,IAAI;AACN,WAAO,IAAIC,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACpC,YAAMC,WAAW,GAAGJ,GAAG,CAACK,MAAxB;;AACA,UAAKL,GAAG,CAACF,QAAJ,CAAaQ,MAAb,KAAwB,GAA7B,EACA;AACIF,QAAAA,WAAW,CAACG,MAAZ,GAAqB,IAArB;AAEA,YAAIC,GAAG,GAAGC,KAAK,CAAE,GAAEjB,YAAa,SAAjB,EAA2B;AACtCkB,UAAAA,MAAM,EAAE,MAD8B;AAEtCC,UAAAA,IAAI,EAAE,MAFgC;AAGtCC,UAAAA,KAAK,EAAE,UAH+B;AAItCC,UAAAA,WAAW,EAAE,aAJyB;AAKtClB,UAAAA,OAAO,EAAE;AACL,4BAAgB,kBADX;AAEL,sBAAU,QAFL;AAGL,qBAASmB,YAAY,CAACC,OAAb,CAAqB,OAArB;AAHJ,WAL6B;AAUtCC,UAAAA,QAAQ,EAAE,QAV4B;AAWtCC,UAAAA,QAAQ,EAAE,aAX4B;AAYtCC,UAAAA,IAAI,EAAEC,IAAI,CAACC,SAAL,CAAe;AACjBC,YAAAA,KAAK,EAAEhC,GAAG;AADO,WAAf;AAZgC,SAA3B,CAAL,CAePiC,IAfO,CAeFd,GAAG,IAAIA,GAAG,CAACe,IAAJ,EAfL,EAeiBD,IAfjB,CAesBd,GAAG,IAAI;AACnCgB,UAAAA,OAAO,CAACC,GAAR,CAAYjB,GAAZ;AACA,eAAKkB,UAAL,CAAgB;AAACL,YAAAA,KAAK,EAAEb,GAAG,CAACa,KAAZ;AAAmBM,YAAAA,aAAa,EAAEnB,GAAG,CAACoB;AAAtC,WAAhB;AACAxB,UAAAA,WAAW,CAACT,OAAZ,CAAoB,eAApB,IAAwC,UAASa,GAAG,CAACa,KAAM,EAA3D;AACAjB,UAAAA,WAAW,CAACT,OAAZ,CAAoB,QAApB,IAAgC,QAAhC;AAGA,iBAAOP,KAAK,CAACgB,WAAD,CAAZ;AACH,SAvBS,CAAV;AA0BAF,QAAAA,OAAO,CAACM,GAAD,CAAP;AACH;;AAGD,aAAOP,OAAO,CAACE,MAAR,CAAeH,GAAf,CAAP;AACH,KArCM,CAAP;AAsCH,GAzCM,CAAP;AA0CH;;AAED,eAAeP,WAAf","sourcesContent":["import {useEffect, useState} from 'react'\r\nimport axios from 'axios'\r\nimport {get, removeToken, set} from \"../TokenService\";\r\nimport {API_AUTH_URL} from \"../constants/constants\";\r\n\r\n\r\nfunction Interceptor() {\r\n    axios.defaults.headers.common['Autherization'] = `Bearer ${get()}`;\r\n    axios.defaults.headers.common['Device'] = \"device\";\r\n    return axios.interceptors.response.use(response => {\r\n        return response;\r\n    }, err => {\r\n        return new Promise((resolve, reject) => {\r\n            const originalReq = err.config;\r\n            if ( err.response.status === 401 )\r\n            {\r\n                originalReq._retry = true;\r\n\r\n                let res = fetch(`${API_AUTH_URL}refresh`, {\r\n                    method: 'POST',\r\n                    mode: 'cors',\r\n                    cache: 'no-cache',\r\n                    credentials: 'same-origin',\r\n                    headers: {\r\n                        'Content-Type': 'application/json',\r\n                        'Device': 'device',\r\n                        'Token': localStorage.getItem(\"token\")\r\n                    },\r\n                    redirect: 'follow',\r\n                    referrer: 'no-referrer',\r\n                    body: JSON.stringify({\r\n                        token: get(),\r\n                    }),\r\n                }).then(res => res.json()).then(res => {\r\n                    console.log(res);\r\n                    this.setSession({token: res.token, refresh_token: res.refresh});\r\n                    originalReq.headers['Autherization'] = `Bearer ${res.token}`;\r\n                    originalReq.headers['Device'] = \"device\";\r\n\r\n\r\n                    return axios(originalReq);\r\n                });\r\n\r\n\r\n                resolve(res);\r\n            }\r\n\r\n\r\n            return Promise.reject(err);\r\n        });\r\n    });\r\n}\r\n\r\nexport default Interceptor\r\n"]},"metadata":{},"sourceType":"module"}