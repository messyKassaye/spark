{"ast":null,"code":"import { useEffect, useState } from 'react';\nimport axios from 'axios';\nimport { get, removeToken, set } from \"../TokenService\";\nimport { API_AUTH_URL } from \"../constants/constants\";\n\nfunction Interceptor() {\n  axios.defaults.headers.common['Autherization'] = `Bearer ${get()}`;\n  axios.defaults.headers.common['Device'] = \"device\";\n  const data = {\n    toke: get()\n  };\n  return axios.interceptors.response.use(response => {\n    return response;\n  }, err => {\n    return new Promise((resolve, reject) => {\n      const originalReq = err.config;\n\n      if (err.response.status === 401) {\n        originalReq._retry = true;\n        let res = fetch(`${API_AUTH_URL}refresh`, {\n          method: 'POST',\n          mode: 'cors',\n          cache: 'no-cache',\n          credentials: 'same-origin',\n          headers: {\n            'Content-Type': 'application/json',\n            'Device': 'device',\n            'Token': localStorage.getItem(\"token\")\n          },\n          redirect: 'follow',\n          referrer: 'no-referrer',\n          body: data\n        }).then(res => res.json()).then(res => {\n          console.log(res);\n          set(res.token); //this.setSession({token: res.token, refresh_token: res.refresh});\n\n          originalReq.headers['Authorization '] = `Bearer ${res.token}`;\n          originalReq.headers['Device'] = \"device\";\n          return axios(originalReq);\n        });\n        resolve(res);\n      }\n\n      return Promise.reject(err);\n    });\n  });\n}\n\nexport default Interceptor;","map":{"version":3,"sources":["D:/projects/spark/spark_front/src/interceptors/Interceptor.js"],"names":["useEffect","useState","axios","get","removeToken","set","API_AUTH_URL","Interceptor","defaults","headers","common","data","toke","interceptors","response","use","err","Promise","resolve","reject","originalReq","config","status","_retry","res","fetch","method","mode","cache","credentials","localStorage","getItem","redirect","referrer","body","then","json","console","log","token"],"mappings":"AAAA,SAAQA,SAAR,EAAmBC,QAAnB,QAAkC,OAAlC;AACA,OAAOC,KAAP,MAAkB,OAAlB;AACA,SAAQC,GAAR,EAAaC,WAAb,EAA0BC,GAA1B,QAAoC,iBAApC;AACA,SAAQC,YAAR,QAA2B,wBAA3B;;AAGA,SAASC,WAAT,GAAuB;AACnBL,EAAAA,KAAK,CAACM,QAAN,CAAeC,OAAf,CAAuBC,MAAvB,CAA8B,eAA9B,IAAkD,UAASP,GAAG,EAAG,EAAjE;AACAD,EAAAA,KAAK,CAACM,QAAN,CAAeC,OAAf,CAAuBC,MAAvB,CAA8B,QAA9B,IAA0C,QAA1C;AACA,QAAMC,IAAI,GAAG;AACTC,IAAAA,IAAI,EAACT,GAAG;AADC,GAAb;AAGA,SAAOD,KAAK,CAACW,YAAN,CAAmBC,QAAnB,CAA4BC,GAA5B,CAAgCD,QAAQ,IAAI;AAC/C,WAAOA,QAAP;AACH,GAFM,EAEJE,GAAG,IAAI;AACN,WAAO,IAAIC,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACpC,YAAMC,WAAW,GAAGJ,GAAG,CAACK,MAAxB;;AACA,UAAKL,GAAG,CAACF,QAAJ,CAAaQ,MAAb,KAAwB,GAA7B,EACA;AACIF,QAAAA,WAAW,CAACG,MAAZ,GAAqB,IAArB;AAEA,YAAIC,GAAG,GAAGC,KAAK,CAAE,GAAEnB,YAAa,SAAjB,EAA2B;AACtCoB,UAAAA,MAAM,EAAE,MAD8B;AAEtCC,UAAAA,IAAI,EAAE,MAFgC;AAGtCC,UAAAA,KAAK,EAAE,UAH+B;AAItCC,UAAAA,WAAW,EAAE,aAJyB;AAKtCpB,UAAAA,OAAO,EAAE;AACL,4BAAgB,kBADX;AAEL,sBAAU,QAFL;AAGL,qBAASqB,YAAY,CAACC,OAAb,CAAqB,OAArB;AAHJ,WAL6B;AAUtCC,UAAAA,QAAQ,EAAE,QAV4B;AAWtCC,UAAAA,QAAQ,EAAE,aAX4B;AAYtCC,UAAAA,IAAI,EAAEvB;AAZgC,SAA3B,CAAL,CAaPwB,IAbO,CAaFX,GAAG,IAAIA,GAAG,CAACY,IAAJ,EAbL,EAaiBD,IAbjB,CAasBX,GAAG,IAAI;AACnCa,UAAAA,OAAO,CAACC,GAAR,CAAYd,GAAZ;AACAnB,UAAAA,GAAG,CAACmB,GAAG,CAACe,KAAL,CAAH,CAFmC,CAGnC;;AACAnB,UAAAA,WAAW,CAACX,OAAZ,CAAoB,gBAApB,IAAyC,UAASe,GAAG,CAACe,KAAM,EAA5D;AACAnB,UAAAA,WAAW,CAACX,OAAZ,CAAoB,QAApB,IAAgC,QAAhC;AAGA,iBAAOP,KAAK,CAACkB,WAAD,CAAZ;AACH,SAtBS,CAAV;AAyBAF,QAAAA,OAAO,CAACM,GAAD,CAAP;AACH;;AAGD,aAAOP,OAAO,CAACE,MAAR,CAAeH,GAAf,CAAP;AACH,KApCM,CAAP;AAqCH,GAxCM,CAAP;AAyCH;;AAED,eAAeT,WAAf","sourcesContent":["import {useEffect, useState} from 'react'\r\nimport axios from 'axios'\r\nimport {get, removeToken, set} from \"../TokenService\";\r\nimport {API_AUTH_URL} from \"../constants/constants\";\r\n\r\n\r\nfunction Interceptor() {\r\n    axios.defaults.headers.common['Autherization'] = `Bearer ${get()}`;\r\n    axios.defaults.headers.common['Device'] = \"device\";\r\n    const data = {\r\n        toke:get()\r\n    }\r\n    return axios.interceptors.response.use(response => {\r\n        return response;\r\n    }, err => {\r\n        return new Promise((resolve, reject) => {\r\n            const originalReq = err.config;\r\n            if ( err.response.status === 401 )\r\n            {\r\n                originalReq._retry = true;\r\n\r\n                let res = fetch(`${API_AUTH_URL}refresh`, {\r\n                    method: 'POST',\r\n                    mode: 'cors',\r\n                    cache: 'no-cache',\r\n                    credentials: 'same-origin',\r\n                    headers: {\r\n                        'Content-Type': 'application/json',\r\n                        'Device': 'device',\r\n                        'Token': localStorage.getItem(\"token\")\r\n                    },\r\n                    redirect: 'follow',\r\n                    referrer: 'no-referrer',\r\n                    body: data,\r\n                }).then(res => res.json()).then(res => {\r\n                    console.log(res);\r\n                    set(res.token)\r\n                    //this.setSession({token: res.token, refresh_token: res.refresh});\r\n                    originalReq.headers['Authorization '] = `Bearer ${res.token}`;\r\n                    originalReq.headers['Device'] = \"device\";\r\n\r\n\r\n                    return axios(originalReq);\r\n                });\r\n\r\n\r\n                resolve(res);\r\n            }\r\n\r\n\r\n            return Promise.reject(err);\r\n        });\r\n    });\r\n}\r\n\r\nexport default Interceptor\r\n"]},"metadata":{},"sourceType":"module"}